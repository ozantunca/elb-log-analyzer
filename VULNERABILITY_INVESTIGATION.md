# Minimatch ReDoS Vulnerability Investigation

## Summary

**CVE:** CVE-2026-26996  
**Package:** minimatch  
**Vulnerability Type:** Regular Expression Denial of Service (ReDoS)  
**Severity:** HIGH (CVSS 8.7)  
**CWE:** CWE-1333  

## Vulnerability Details

The `minimatch` package is vulnerable to ReDoS in the `AST` class. The issue occurs when glob patterns contain multiple consecutive `*` wildcards followed by a literal character that doesn't appear in the test string. This causes exponential backtracking in V8's regex engine, resulting in:

- **N=15:** ~2 seconds per `minimatch()` call
- **N=34:** Application hangs indefinitely

### Impact on elb-log-analyzer

The application uses `glob` for file discovery in `src/utils/collectFileNames.ts`. User-supplied file paths/patterns are passed to glob, which internally uses minimatch. If an attacker can influence the file patterns (e.g., via CLI arguments or API), they could potentially trigger ReDoS.

**Attack vector:** The `files` parameter in the library API and CLI can accept glob patterns. Malicious patterns like `**********x` (repeated wildcards + non-matching char) could cause denial of service.

## Current Dependency State

| Package | Resolved Version | Status |
|---------|-----------------|--------|
| **glob** (direct) | 8.0.3 | Uses minimatch 5.1.0 (VULNERABLE) |
| glob → minimatch | 5.1.0 | Fixed in 5.1.7 |
| minimatch (transitive) | 3.1.2 | Fixed in 3.1.3 |
| jest-config, jest-runtime, etc. | glob 7.2.3 | Uses minimatch 3.1.1 (VULNERABLE) |

### Fixed Versions (minimatch)

- 3.x: 3.1.3+
- 4.x: 4.2.4+
- 5.x: 5.1.7+
- 6.x: 6.2.1+
- 7.x: 7.4.7+
- 8.x: 8.0.5+
- 9.x: 9.0.6+
- 10.x: 10.2.1+

## Remediation

**Recommended:** Upgrade `glob` from `^8.0.3` to `^13.0.6`

- **glob@13.0.6** uses `minimatch ^10.2.2` (patched)
- **glob@12.0.0** uses `minimatch ^10.1.1` (may resolve to vulnerable 10.2.0)

**Breaking change:** glob v9+ removed callback support. The code uses `promisify(require('glob'))`—glob v9+ returns promises natively, so the code must be updated to use the new API.

### Remediation Applied (2025-02-22)

- **Upgraded** `glob` from `^8.0.3` to `^13.0.6`
- **Updated** `collectFileNames.ts` to use glob's native promise API (glob v9+ removed callbacks)
- **Added** `skipLibCheck: true` to tsconfig (glob v13 types reference DOM APIs; skipLibCheck is standard practice)
- **Result:** Direct dependency `glob@13.0.6` → `minimatch@10.2.2` (patched)

### DevDependencies Note

Jest and other dev dependencies (eslint-plugin-import, test-exclude, etc.) still use vulnerable glob@7.x/minimatch@3.x. These affect development/test only, not production runtime. Consider:

- Upgrading Jest to a version that uses patched dependencies (when available)
- Using `npm audit fix` for automatable fixes
- Accepting dev-only risk if production is the priority
